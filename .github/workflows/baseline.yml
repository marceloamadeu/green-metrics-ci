name: 01-Baseline (Sequencial)
on: 
  workflow_dispatch:

jobs:
  test-baseline:
    runs-on: self-hosted
    steps:
      - name: Checkout Code
        uses: actions/checkout@v4

      - name: Setup Python (System)
        run: |
          # Usa o python do sistema e cria venv para isolamento
          python3 -m venv venv
          echo "$GITHUB_WORKSPACE/venv/bin" >> $GITHUB_PATH

      - name: Install Dependencies
        run: |
          pip install --upgrade pip
          pip install -r requirements.txt

      - name: Iniciar Medição (Eco-CI)
        uses: green-coding-solutions/eco-ci-energy-estimation@v4
        with:
          task: start-measurement
          label: 'baseline-run'

      - name: Rodar Testes (Sequencial)
        run: |
          # Executa todos os testes sequencialmente
          pytest src/test_app.py

      - name: Coletar Métricas
        uses: green-coding-solutions/eco-ci-energy-estimation@v4
        with:
          task: get-measurement
          label: 'baseline-tests'
          
      - name: Exibir Resultados
        uses: green-coding-solutions/eco-ci-energy-estimation@v4
        with:
          task: display-results
          json-output: true